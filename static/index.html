<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bear Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="/static/style.css" />
</head>

<body>

<header>
  <h1>üêª Bear Planner</h1>
</header>

<!-- TOP TOOLBAR -->
<div class="toolbar">
  <button>Placeholder 1</button>
  <button>Placeholder 2</button>
  <button>Placeholder 3</button>
  <button>Placeholder 4</button>
  <button id="howToBtn" class="secondary">How to Use</button>
</div>

<main>

  <!-- MAP PANEL -->
  <section class="map-panel">
    <h2>Map</h2>

    <div class="canvas-column">
      <div class="canvas-actions">
        <button id="autoPlaceBtn">Auto Place Castles</button>
        <button id="downloadBtn">Download Map</button>
      </div>

      <div class="canvas-wrap">
        <div id="efficiencyLegend" class="efficiency-legend"></div>
        <canvas id="map" width="1600" height="1600" aria-label="Interactive map for castle placement"></canvas>
      </div>
    </div>
  </section>

  <!-- CASTLE PANEL -->
  <section class="castle-panel">
    <h2>Castles</h2>

    <div class="castle-toolbar">
      <input
        id="castleSearch"
        type="search"
        placeholder="Search by ID, player, preference‚Ä¶"
        autocomplete="off"
        aria-label="Search castles"
      />
      <!-- New: Dropdown to limit view to all or top N castles -->
      <select id="castleLimit" aria-label="Limit castles shown">
        <option value="all">All Castles</option>
        <option value="10">Top 10</option>
        <option value="20">Top 20</option>
        <option value="50">Top 50</option>
        <option value="100">Top 100</option>
      </select>
      <button id="uploadCsvBtn" aria-label="Upload CSV file">Upload CSV</button>
      <button class="secondary" aria-label="Download CSV file">Download CSV</button>
      <button id="addCastleBtn">Add Castle</button>
      <button id="addBearBtn">Add Bear</button>
    </div>

    <div class="table-wrap">
      <table id="castleTable" role="table" aria-label="Castle data table">
        <thead>
          <tr>
            <th data-sort="id">ID</th>
            <th data-sort="player">Player</th>
            <th data-sort="power">Power</th>
            <th data-sort="player_level">Lv</th>
            <th data-sort="command_centre_level">CC</th>
            <th data-sort="attendance">Attend</th>
            <th data-sort="preference">Preference</th>
            <th data-sort="locked">Locked</th>
            <th data-sort="rallies_30min">Rallies/Session</th>
            <th data-sort="round_trip">Round Trip Time (s)</th>
            <th data-sort="priority">Priority</th>
            <th data-sort="efficiency">Efficiency</th>
            <th data-sort="last_updated">Last Updated</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="castleTableBody">
          <!-- Rows will be added via JS with data-id and hover/click handlers -->
        </tbody>
      </table>
    </div>

    <div class="actions">
      <button onclick="lockAllPlaced()" aria-label="Lock all placed castles">Lock All</button>
      <button onclick="unlockAll()" aria-label="Unlock all castles">Unlock All</button>
    </div>
  </section>

</main>

<input type="file" id="csvUpload" accept=".csv" hidden aria-label="CSV file input" />

<!-- Castle Tooltip -->
<div id="castleTooltip" aria-live="polite"></div>

<footer>
  ¬© 2025 Matthew Picone ‚Äî All rights reserved | <span id="appVersion">Loading version...</span> | 
  <span id="userInfo">
    <span id="loggedInUser" style="display: none;">Logged in as: <strong id="username"></strong> | <a href="#" id="logoutBtn">Logout</a></span>
    <span id="notLoggedIn"><a href="#" id="loginBtn">Login</a></span>
  </span>
</footer>

<!-- Login Modal -->
<div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--panel); border: 1px solid var(--border); padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
    <h2>Login</h2>
    <div id="loginError" style="color: #ef4444; margin-bottom: 10px; display: none;"></div>
    <form id="loginForm">
      <div style="margin-bottom: 15px;">
        <label for="loginUsername" style="display: block; margin-bottom: 5px;">Username:</label>
        <input type="text" id="loginUsername" required style="width: 100%; padding: 8px; box-sizing: border-box;" />
      </div>
      <div style="margin-bottom: 20px;">
        <label for="loginPassword" style="display: block; margin-bottom: 5px;">Password:</label>
        <input type="password" id="loginPassword" required style="width: 100%; padding: 8px; box-sizing: border-box;" />
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button type="button" id="cancelLogin">Cancel</button>
        <button type="submit" class="primary">Login</button>
      </div>
    </form>
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center;">
      <p>Don't have an account? <a href="#" id="showRegister">Register</a></p>
    </div>
  </div>
</div>

<!-- Register Modal -->
<div id="registerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--panel); border: 1px solid var(--border); padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
    <h2>Register</h2>
    <div id="registerError" style="color: #ef4444; margin-bottom: 10px; display: none;"></div>
    <div id="registerSuccess" style="color: #10b981; margin-bottom: 10px; display: none;"></div>
    <form id="registerForm">
      <div style="margin-bottom: 15px;">
        <label for="registerUsername" style="display: block; margin-bottom: 5px;">Username:</label>
        <input type="text" id="registerUsername" required style="width: 100%; padding: 8px; box-sizing: border-box;" />
      </div>
      <div style="margin-bottom: 15px;">
        <label for="registerFullName" style="display: block; margin-bottom: 5px;">Full Name:</label>
        <input type="text" id="registerFullName" style="width: 100%; padding: 8px; box-sizing: border-box;" />
      </div>
      <div style="margin-bottom: 20px;">
        <label for="registerPassword" style="display: block; margin-bottom: 5px;">Password:</label>
        <input type="password" id="registerPassword" required minlength="6" style="width: 100%; padding: 8px; box-sizing: border-box;" />
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button type="button" id="cancelRegister">Cancel</button>
        <button type="submit" class="primary">Register</button>
      </div>
    </form>
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center;">
      <p>Already have an account? <a href="#" id="showLogin">Login</a></p>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--panel); border: 1px solid var(--border); padding: 20px; z-index: 10; border-radius: 8px;">
  <h3 id="deleteTitle">Delete Castle</h3>
  <label>Reason:</label>
  <select id="deleteReason">
    <option value="">Select reason</option>
    <option value="No longer in alliance">No longer in alliance</option>
    <option value="Created in error">Created in error</option>
    <option value="Other">Other</option>
  </select>
  <input id="deleteOther" type="text" placeholder="Please explain" style="display: none; margin-top: 10px; width: 100%;" />
  <div style="margin-top: 20px; text-align: right;">
    <button id="cancelDelete">Cancel</button>
    <button id="confirmDelete">Delete</button>
  </div>
</div>
<script src="/static/auth.js"></script>
<script src="/static/sync.js"></script>
<script src="/static/app.js"></script>

</body>
</html>